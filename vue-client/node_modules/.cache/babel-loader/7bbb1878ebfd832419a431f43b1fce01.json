{"remainingRequest":"/home/spineor/Downloads/aelis4-web/vue-client/node_modules/babel-loader/lib/index.js!/home/spineor/Downloads/aelis4-web/vue-client/node_modules/eslint-loader/index.js??ref--13-0!/home/spineor/Downloads/aelis4-web/vue-client/src/utils/auth/auth0Service.js","dependencies":[{"path":"/home/spineor/Downloads/aelis4-web/vue-client/src/utils/auth/auth0Service.js","mtime":1562577473000},{"path":"/home/spineor/Downloads/aelis4-web/vue-client/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/spineor/Downloads/aelis4-web/vue-client/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/spineor/Downloads/aelis4-web/vue-client/node_modules/eslint-loader/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _classCallCheck from \"/home/spineor/Downloads/aelis4-web/vue-client/node_modules/@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/spineor/Downloads/aelis4-web/vue-client/node_modules/@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"/home/spineor/Downloads/aelis4-web/vue-client/node_modules/@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/home/spineor/Downloads/aelis4-web/vue-client/node_modules/@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _assertThisInitialized from \"/home/spineor/Downloads/aelis4-web/vue-client/node_modules/@babel/runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/home/spineor/Downloads/aelis4-web/vue-client/node_modules/@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"/home/spineor/Downloads/aelis4-web/vue-client/node_modules/@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport auth0 from 'auth0-js';\nimport { EventEmitter } from 'events';\nimport authConfig from \"./auth_config\";\nvar webAuth = new auth0.WebAuth({\n  domain: authConfig.domain,\n  redirectUri: \"\".concat(window.location.origin, \"/callback\"),\n  clientID: process.env.VUE_APP_AUTH0_CLIENT_ID || 'test',\n  responseType: 'token id_token',\n  scope: 'openid profile upload:dataEntry',\n  audience: process.env.VUE_APP_AUDIENCE || 'test',\n  leeway: 60\n});\nvar localStorageKey = 'loggedIn';\nvar loginEvent = 'loginEvent';\n\nvar AuthService =\n/*#__PURE__*/\nfunction (_EventEmitter) {\n  _inherits(AuthService, _EventEmitter);\n\n  function AuthService() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, AuthService);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(AuthService)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_this), \"idToken\", null);\n\n    _defineProperty(_assertThisInitialized(_this), \"accessToken\", null);\n\n    _defineProperty(_assertThisInitialized(_this), \"profile\", null);\n\n    _defineProperty(_assertThisInitialized(_this), \"tokenExpiry\", null);\n\n    _defineProperty(_assertThisInitialized(_this), \"accessTokenExpiry\", null);\n\n    _defineProperty(_assertThisInitialized(_this), \"defaultState\", '/');\n\n    _defineProperty(_assertThisInitialized(_this), \"errorMessage\", '');\n\n    return _this;\n  }\n\n  _createClass(AuthService, [{\n    key: \"login\",\n    value: function login(customState) {\n      webAuth.authorize({\n        appState: customState || this.defaultState,\n        errorMessage: this.errorMessage\n      });\n    }\n  }, {\n    key: \"logOut\",\n    value: function logOut() {\n      var _this2 = this;\n\n      localStorage.removeItem(localStorageKey);\n      this.idToken = null;\n      this.accessToken = null;\n      this.tokenExpiry = null;\n      this.profile = null;\n      this.accessTokenExpiry = null;\n      webAuth.logout({\n        returnTo: \"\".concat(window.location.origin)\n      });\n      setTimeout(function () {\n        _this2.emit(loginEvent, {\n          loggedIn: false\n        });\n      }, 500);\n    }\n  }, {\n    key: \"handleAuthentication\",\n    value: function handleAuthentication() {\n      var _this3 = this;\n\n      return new Promise(function (resolve, reject) {\n        webAuth.parseHash(function (err, authResult) {\n          if (err) {\n            _this3.errorMessage = err.errorDescription;\n\n            _this3.login(err.state);\n\n            reject(err);\n          } else {\n            _this3.localLogin(authResult);\n\n            resolve(authResult.idToken);\n          }\n        });\n      });\n    }\n  }, {\n    key: \"isAuthenticated\",\n    value: function isAuthenticated() {\n      return Date.now() < this.tokenExpiry && localStorage.getItem(localStorageKey) === 'true';\n    }\n  }, {\n    key: \"isIdTokenValid\",\n    value: function isIdTokenValid() {\n      return this.idToken && this.tokenExpiry && Date.now() < this.tokenExpiry;\n    }\n  }, {\n    key: \"isAccessTokenValid\",\n    value: function isAccessTokenValid() {\n      return this.accessToken && this.accessTokenExpiry && Date.now() < this.accessTokenExpiry;\n    }\n  }, {\n    key: \"getIdToken\",\n    value: function getIdToken() {\n      var _this4 = this;\n\n      return new Promise(function (resolve, reject) {\n        if (_this4.isIdTokenValid()) {\n          resolve(_this4.idToken);\n        } else if (_this4.isAuthenticated()) {\n          _this4.renewTokens().then(function (authResult) {\n            resolve(authResult.idToken);\n          }, reject(new Error('Unable to renew authentication')));\n        } else {\n          resolve('Not Authenticated');\n        }\n      });\n    }\n  }, {\n    key: \"getAccessToken\",\n    value: function getAccessToken() {\n      var _this5 = this;\n\n      return new Promise(function (resolve, reject) {\n        if (_this5.isAccessTokenValid()) {\n          resolve(_this5.accessToken);\n        } else {\n          _this5.renewTokens().then(function (authResult) {\n            resolve(authResult.accessToken);\n          }, reject);\n        }\n      });\n    }\n  }, {\n    key: \"localLogin\",\n    value: function localLogin(authResult) {\n      this.idToken = authResult.idToken;\n      this.profile = authResult.idTokenPayload;\n      this.accessToken = authResult.accessToken; // Convert the expiry time from seconds to milliseconds,\n      // required by the Date constructor\n\n      this.tokenExpiry = new Date(this.profile.exp * 1000); // Convert expiresIn to milliseconds and add the current time\n      // (expiresIn is a relative timestamp, we want an absolute time)\n\n      this.accessTokenExpiry = new Date(Date.now() + authResult.expiresIn * 1000);\n      localStorage.setItem(localStorageKey, 'true');\n      this.emit(loginEvent, {\n        loggedIn: true,\n        profile: authResult.idTokenPayload,\n        state: authResult.appState || {}\n      });\n    }\n  }, {\n    key: \"renewTokens\",\n    value: function renewTokens() {\n      var _this6 = this;\n\n      return new Promise(function (resolve, reject) {\n        if (localStorage.getItem(localStorageKey) !== 'true') {\n          reject(new Error('Not logged in'));\n        }\n\n        webAuth.checkSession({}, function (err, authResult) {\n          if (err) {\n            reject(err);\n          } else {\n            _this6.localLogin(authResult);\n\n            resolve(authResult);\n          }\n        });\n      });\n    }\n  }]);\n\n  return AuthService;\n}(EventEmitter);\n\nvar auth0Service = new AuthService();\nauth0Service.setMaxListeners(5);\nexport default auth0Service;",{"version":3,"sources":["/home/spineor/Downloads/aelis4-web/vue-client/src/utils/auth/auth0Service.js"],"names":["auth0","EventEmitter","authConfig","webAuth","WebAuth","domain","redirectUri","window","location","origin","clientID","process","env","VUE_APP_AUTH0_CLIENT_ID","responseType","scope","audience","VUE_APP_AUDIENCE","leeway","localStorageKey","loginEvent","AuthService","customState","authorize","appState","defaultState","errorMessage","localStorage","removeItem","idToken","accessToken","tokenExpiry","profile","accessTokenExpiry","logout","returnTo","setTimeout","emit","loggedIn","Promise","resolve","reject","parseHash","err","authResult","errorDescription","login","state","localLogin","Date","now","getItem","isIdTokenValid","isAuthenticated","renewTokens","then","Error","isAccessTokenValid","idTokenPayload","exp","expiresIn","setItem","checkSession","auth0Service","setMaxListeners"],"mappings":"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","sourcesContent":["import auth0 from 'auth0-js';\nimport { EventEmitter } from 'events';\nimport authConfig from './auth_config';\n\nconst webAuth = new auth0.WebAuth({\n  domain: authConfig.domain,\n  redirectUri: `${window.location.origin}/callback`,\n  clientID: process.env.VUE_APP_AUTH0_CLIENT_ID || 'test',\n  responseType: 'token id_token',\n  scope: 'openid profile upload:dataEntry',\n  audience: process.env.VUE_APP_AUDIENCE || 'test',\n  leeway: 60\n});\n\nconst localStorageKey = 'loggedIn';\nconst loginEvent = 'loginEvent';\n\nclass AuthService extends EventEmitter {\n  idToken = null;\n\n  accessToken = null;\n\n  profile = null;\n\n  tokenExpiry = null;\n\n  accessTokenExpiry = null;\n\n  defaultState = '/';\n\n  errorMessage = '';\n\n  login(customState) {\n    webAuth.authorize({\n      appState: customState || this.defaultState,\n      errorMessage: this.errorMessage\n    });\n  }\n\n  logOut() {\n    localStorage.removeItem(localStorageKey);\n\n    this.idToken = null;\n    this.accessToken = null;\n    this.tokenExpiry = null;\n    this.profile = null;\n    this.accessTokenExpiry = null;\n\n    webAuth.logout({\n      returnTo: `${window.location.origin}`\n    });\n\n    setTimeout(() => {\n      this.emit(loginEvent, { loggedIn: false });\n    }, 500);\n  }\n\n  handleAuthentication() {\n    return new Promise((resolve, reject) => {\n      webAuth.parseHash((err, authResult) => {\n        if (err) {\n          this.errorMessage = err.errorDescription;\n          this.login(err.state);\n          reject(err);\n        } else {\n          this.localLogin(authResult);\n          resolve(authResult.idToken);\n        }\n      });\n    });\n  }\n\n  isAuthenticated() {\n    return (\n      Date.now() < this.tokenExpiry\n      && localStorage.getItem(localStorageKey) === 'true'\n    );\n  }\n\n  isIdTokenValid() {\n    return (\n      this.idToken\n      && this.tokenExpiry\n      && Date.now() < this.tokenExpiry\n    );\n  }\n\n  isAccessTokenValid() {\n    return (\n      this.accessToken\n      && this.accessTokenExpiry\n      && Date.now() < this.accessTokenExpiry\n    );\n  }\n\n  getIdToken() {\n    return new Promise((resolve, reject) => {\n      if (this.isIdTokenValid()) {\n        resolve(this.idToken);\n      } else if (this.isAuthenticated()) {\n        this.renewTokens().then((authResult) => {\n          resolve(authResult.idToken);\n        }, reject(new Error('Unable to renew authentication')));\n      } else {\n        resolve('Not Authenticated');\n      }\n    });\n  }\n\n  getAccessToken() {\n    return new Promise((resolve, reject) => {\n      if (this.isAccessTokenValid()) {\n        resolve(this.accessToken);\n      } else {\n        this.renewTokens().then((authResult) => {\n          resolve(authResult.accessToken);\n        }, reject);\n      }\n    });\n  }\n\n  localLogin(authResult) {\n    this.idToken = authResult.idToken;\n    this.profile = authResult.idTokenPayload;\n\n    this.accessToken = authResult.accessToken;\n\n    // Convert the expiry time from seconds to milliseconds,\n    // required by the Date constructor\n    this.tokenExpiry = new Date(this.profile.exp * 1000);\n\n    // Convert expiresIn to milliseconds and add the current time\n    // (expiresIn is a relative timestamp, we want an absolute time)\n    this.accessTokenExpiry = new Date(Date.now() + authResult.expiresIn * 1000);\n\n    localStorage.setItem(localStorageKey, 'true');\n\n    this.emit(loginEvent, {\n      loggedIn: true,\n      profile: authResult.idTokenPayload,\n      state: authResult.appState || {}\n    });\n  }\n\n  renewTokens() {\n    return new Promise((resolve, reject) => {\n      if (localStorage.getItem(localStorageKey) !== 'true') {\n        reject(new Error('Not logged in'));\n      }\n\n      webAuth.checkSession({}, (err, authResult) => {\n        if (err) {\n          reject(err);\n        } else {\n          this.localLogin(authResult);\n          resolve(authResult);\n        }\n      });\n    });\n  }\n}\n\nconst auth0Service = new AuthService();\nauth0Service.setMaxListeners(5);\n\nexport default auth0Service;\n"]}]}